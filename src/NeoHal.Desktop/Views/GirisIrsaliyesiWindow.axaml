<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NeoHal.Desktop.ViewModels"
        xmlns:m="using:NeoHal.Core.Entities"
        x:Class="NeoHal.Desktop.Views.GirisIrsaliyesiWindow"
        x:DataType="vm:GirisIrsaliyesiEditViewModel"
        Title="{Binding WindowTitle}"
        Width="1200" Height="800"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundDarkBrush}"
        Name="IrsaliyeWindow">
    
    <Grid RowDefinitions="Auto,Auto,*,Auto">
        
        <!-- Ãœst Bar - BaÅŸlÄ±k ve MÃ¼stahsil SeÃ§imi -->
        <Border Grid.Row="0" Background="{DynamicResource SuccessBrush}" Padding="20,15">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                    <TextBlock Text="ðŸ“‹ GÄ°RÄ°Åž Ä°RSALÄ°YESÄ°" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Komisyoncu ve Ã¼rÃ¼nÃ¼ satÄ±rda seÃ§ â†’ Kaydet" Foreground="#a5d6a7" FontSize="13"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
                    <Button Content="Ä°ptal (ESC)" Command="{Binding CancelCommand}" 
                            Background="{DynamicResource BackgroundMediumBrush}" Foreground="White" Padding="15,8"/>
                    <Button Content="ðŸ’¾ Kaydet (F9)" Command="{Binding SaveCommand}" 
                            Background="#4CAF50" Foreground="White" Padding="20,8" FontWeight="Bold"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- KayÄ±t Bilgileri -->
        <Border Grid.Row="1" Background="{DynamicResource BackgroundDarkBrush}" Padding="15">
            <Grid ColumnDefinitions="Auto,150,30,Auto,150,30,Auto,180,*">
                <TextBlock Text="Tarih:" VerticalAlignment="Center" Foreground="#aaa"/>
                <DatePicker Grid.Column="1" SelectedDate="{Binding Tarih}"/>
                
                <TextBlock Grid.Column="3" Text="Ä°rsaliye No:" VerticalAlignment="Center" Foreground="#aaa"/>
                <TextBox Grid.Column="4" Text="{Binding IrsaliyeNo}" IsReadOnly="True" Background="#333"/>
                
                <!-- Toplam Net -->
                <Border Grid.Column="8" Background="#4CAF50" CornerRadius="8" Padding="20,8" HorizontalAlignment="Right" Margin="20,0,0,0">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="TOPLAM NET: " Foreground="#a5d6a7" FontSize="14" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding ToplamNet, StringFormat=N2}" 
                                   FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                        <TextBlock Text=" kg" FontSize="14" Foreground="White" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        
        <!-- ANA TABLO - DataGrid -->
        <Border Grid.Row="2" Background="{DynamicResource BackgroundMediumBrush}" Padding="10">
            <DataGrid ItemsSource="{Binding Kalemler}"
                      SelectedItem="{Binding SelectedKalem}"
                      AutoGenerateColumns="False"
                      CanUserResizeColumns="True"
                      GridLinesVisibility="All"
                      BorderThickness="1"
                      BorderBrush="#444"
                      IsReadOnly="False"
                      SelectionMode="Single"
                      Background="{DynamicResource BackgroundMediumBrush}"
                      RowBackground="{DynamicResource BackgroundMediumBrush}"
                      x:Name="MainDataGrid">
                
                <DataGrid.Columns>
                    <!-- KOMÄ°SYONCU - Hal alÄ±ÅŸÄ±nda dolu, normal irsaliyede boÅŸ -->
                    <DataGridTemplateColumn Header="Komisyoncu" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <TextBlock Text="{Binding KomisyoncuAdi}" Padding="8,4" VerticalAlignment="Center" 
                                           Foreground="#2196F3" FontWeight="SemiBold"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <AutoCompleteBox ItemsSource="{Binding $parent[DataGrid].((vm:GirisIrsaliyesiEditViewModel)DataContext).Komisyoncular}"
                                                 SelectedItem="{Binding Komisyoncu}"
                                                 FilterMode="ContainsOrdinal"
                                                 MinimumPrefixLength="0"
                                                 Watermark="Komisyoncu seÃ§..."
                                                 ValueMemberBinding="{Binding Unvan}">
                                    <AutoCompleteBox.ItemTemplate>
                                        <DataTemplate x:DataType="m:CariHesap">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Kod}" Foreground="#2196F3" Width="60" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Unvan}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </AutoCompleteBox.ItemTemplate>
                                </AutoCompleteBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- ÃœRÃœN -->
                    <DataGridTemplateColumn Header="ÃœrÃ¼n" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <StackPanel Orientation="Horizontal" Spacing="5" Margin="8,4">
                                    <TextBlock Text="{Binding Urun.Kod}" Foreground="#888" FontSize="11"/>
                                    <TextBlock Text="{Binding UrunAdi}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <AutoCompleteBox ItemsSource="{Binding $parent[DataGrid].((vm:GirisIrsaliyesiEditViewModel)DataContext).Urunler}"
                                                 SelectedItem="{Binding Urun}"
                                                 FilterMode="ContainsOrdinal"
                                                 MinimumPrefixLength="0"
                                                 Watermark="Yaz: PAT, BIB..."
                                                 ValueMemberBinding="{Binding Ad}">
                                    <AutoCompleteBox.ItemTemplate>
                                        <DataTemplate x:DataType="m:Urun">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Kod}" Foreground="#4CAF50" Width="50" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Ad}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </AutoCompleteBox.ItemTemplate>
                                </AutoCompleteBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- KAP TÄ°PÄ° -->
                    <DataGridTemplateColumn Header="Kap Tipi" Width="130">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <TextBlock Text="{Binding KapTipiAdi}" Padding="8,4" VerticalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellEditingTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <AutoCompleteBox ItemsSource="{Binding $parent[DataGrid].((vm:GirisIrsaliyesiEditViewModel)DataContext).KapTipleri}"
                                                 SelectedItem="{Binding KapTipi}"
                                                 FilterMode="ContainsOrdinal"
                                                 MinimumPrefixLength="0"
                                                 Watermark="KÃœÃ‡, PLA..."
                                                 ValueMemberBinding="{Binding Ad}">
                                    <AutoCompleteBox.ItemTemplate>
                                        <DataTemplate x:DataType="m:KapTipi">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Kod}" Foreground="#FF9800" Width="40"/>
                                                <TextBlock Text="{Binding Ad}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </AutoCompleteBox.ItemTemplate>
                                </AutoCompleteBox>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellEditingTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- KAP ADET -->
                    <DataGridTextColumn Header="Kap Ad." Width="80" 
                                        Binding="{Binding KapAdet}"/>
                    
                    <!-- DARALI KG (Kasayla birlikte) -->
                    <DataGridTextColumn Header="DaralÄ± Kg" Width="100"
                                        Binding="{Binding DaraliKg, StringFormat=N2}"/>
                    
                    <!-- NET KG (Otomatik: DaralÄ± - KapÃ—Dara) -->
                    <DataGridTextColumn Header="Net Kg" Width="100"
                                        Binding="{Binding NetKg, StringFormat=N2}"
                                        IsReadOnly="True"
                                        Foreground="#4CAF50"/>
                    
                    <!-- BÄ°RÄ°M FÄ°YAT -->
                    <DataGridTextColumn Header="Fiyat (â‚º)" Width="100"
                                        Binding="{Binding BirimFiyat, StringFormat=N2}"/>
                    
                    <!-- TUTAR -->
                    <DataGridTextColumn Header="Tutar (â‚º)" Width="120"
                                        Binding="{Binding Tutar, StringFormat=N2}"
                                        IsReadOnly="True"
                                        Foreground="#FFC107"
                                        FontWeight="Bold"/>
                    
                    <!-- KOPYALA ve SÄ°L ButonlarÄ± -->
                    <DataGridTemplateColumn Header="" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate x:DataType="vm:GirisKalem">
                                <StackPanel Orientation="Horizontal" Spacing="2">
                                    <Button Content="ðŸ“‹" 
                                            Command="{Binding $parent[DataGrid].((vm:GirisIrsaliyesiEditViewModel)DataContext).KopyalaKalemCommand}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent"
                                            Foreground="#2196F3"
                                            ToolTip.Tip="SatÄ±rÄ± Kopyala"
                                            Padding="5"/>
                                    <Button Content="ðŸ—‘" 
                                            Command="{Binding $parent[DataGrid].((vm:GirisIrsaliyesiEditViewModel)DataContext).SilKalemCommand}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent"
                                            Foreground="#F44336"
                                            ToolTip.Tip="SatÄ±rÄ± Sil"
                                            Padding="5"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
        
        <!-- Alt Bar: Toplamlar ve Butonlar -->
        <Border Grid.Row="3" Background="{DynamicResource BackgroundMediumBrush}" Padding="15">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Toplamlar -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="30">
                    <Border Background="#333" CornerRadius="5" Padding="15,10">
                        <StackPanel>
                            <TextBlock Text="TOPLAM KAP" Foreground="Gray" FontSize="10"/>
                            <TextBlock Text="{Binding ToplamKapAdet}" FontSize="20" FontWeight="Bold" Foreground="White"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#333" CornerRadius="5" Padding="15,10">
                        <StackPanel>
                            <TextBlock Text="DARALI KG" Foreground="Gray" FontSize="10"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding ToplamDaraliKg, StringFormat=N2}" FontSize="20" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text=" kg" FontSize="12" Foreground="Gray" VerticalAlignment="Bottom" Margin="0,0,0,3"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    <Border Background="#333" CornerRadius="5" Padding="15,10">
                        <StackPanel>
                            <TextBlock Text="TOPLAM DARA" Foreground="Gray" FontSize="10"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding ToplamDara, StringFormat=N2}" FontSize="20" FontWeight="Bold" Foreground="Gray"/>
                                <TextBlock Text=" kg" FontSize="12" Foreground="Gray" VerticalAlignment="Bottom" Margin="0,0,0,3"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    <Border Background="#4CAF50" CornerRadius="5" Padding="15,10">
                        <StackPanel>
                            <TextBlock Text="TOPLAM NET" Foreground="#a5d6a7" FontSize="10"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding ToplamNet, StringFormat=N2}" FontSize="20" FontWeight="Bold" Foreground="White"/>
                                <TextBlock Text=" kg" FontSize="12" Foreground="White" VerticalAlignment="Bottom" Margin="0,0,0,3"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    <Border Background="#FFC107" CornerRadius="5" Padding="15,10">
                        <StackPanel>
                            <TextBlock Text="TOPLAM TUTAR" Foreground="#333" FontSize="10"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding ToplamTutar, StringFormat=N2}" FontSize="20" FontWeight="Bold" Foreground="#333"/>
                                <TextBlock Text=" â‚º" FontSize="12" Foreground="#333" VerticalAlignment="Bottom" Margin="0,0,0,3"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
                
                <!-- Butonlar -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                    <Button Content="âž• Yeni SatÄ±r (F5)" 
                            Command="{Binding YeniSatirCommand}"
                            Background="#333"
                            Foreground="White"
                            Padding="15,10"/>
                    <Button Content="Ä°ptal (ESC)" 
                            Command="{Binding CancelCommand}"
                            Background="{DynamicResource BackgroundMediumBrush}"
                            Foreground="White"
                            Padding="15,10"/>
                    <Button Content="ðŸ’¾ Kaydet (F9)" 
                            Command="{Binding SaveCommand}"
                            Background="#4CAF50"
                            Foreground="White"
                            FontWeight="Bold"
                            Padding="25,10"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
