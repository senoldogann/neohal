<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NeoHal.Desktop.ViewModels"
             x:Class="NeoHal.Desktop.Views.UrunView"
             x:DataType="vm:UrunViewModel">
    
    <Grid ColumnDefinitions="*,350">
        <!-- Sol Panel - Liste -->
        <Grid Grid.Column="0" RowDefinitions="Auto,*">
            <!-- Toolbar -->
            <Border Grid.Row="0" Background="{DynamicResource BackgroundDarkBrush}" Padding="15">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto">
                    <!-- Arama -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <ComboBox Grid.Column="0" Width="150" Margin="0,0,10,0"
                                  ItemsSource="{Binding Gruplar}"
                                  SelectedItem="{Binding SelectedGrup}"
                                  PlaceholderText="Tüm Gruplar">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Ad}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <TextBox Grid.Column="1" 
                                 Text="{Binding SearchText}" 
                                 Watermark="Ürün Ara (Kod/Ad)..."
                                 Width="250"/>
                        <Button Grid.Column="2" Content="Ara" Margin="5,0,0,0"
                                Command="{Binding SearchCommand}"/>
                    </Grid>
                    
                    <Button Grid.Column="1" Content="+ Yeni Ürün" 
                            Command="{Binding NewUrunCommand}"
                            Margin="15,0,0,0"
                            Classes="accent"/>
                    <Button Grid.Column="2" Content="Düzenle" 
                            Command="{Binding EditUrunCommand}"
                            Margin="5,0,0,0"
                            IsEnabled="{Binding SelectedUrun, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                    <Button Grid.Column="3" Content="Sil" 
                            Command="{Binding DeleteCommand}"
                            Margin="5,0,0,0"
                            IsEnabled="{Binding SelectedUrun, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                    <Button Grid.Column="4" Content="Yenile" 
                            Command="{Binding SearchCommand}"
                            Margin="5,0,0,0"/>
                </Grid>
            </Border>
            
            <!-- DataGrid -->
            <DataGrid Grid.Row="1" 
                      ItemsSource="{Binding Urunler}"
                      SelectedItem="{Binding SelectedUrun}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserReorderColumns="True"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="Horizontal"
                      SelectionMode="Single">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Kod" Binding="{Binding Kod}" Width="100"/>
                    <DataGridTextColumn Header="Ürün Adı" Binding="{Binding Ad}" Width="*"/>
                    <DataGridTextColumn Header="Grup" Binding="{Binding Grup.Ad}" Width="120"/>
                    <DataGridTextColumn Header="Birim" Binding="{Binding Birim}" Width="80"/>
                    <DataGridTextColumn Header="KDV %" Binding="{Binding KdvOrani, StringFormat=N0}" Width="60"/>
                    <DataGridTextColumn Header="Rusum %" Binding="{Binding RusumOrani, StringFormat=N0}" Width="70"/>
                    <DataGridTextColumn Header="Stopaj %" Binding="{Binding StopajOrani, StringFormat=N0}" Width="70"/>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
        
        <!-- Sag Panel - Duzenleme -->
        <Border Grid.Column="1" 
                Background="{DynamicResource BackgroundMediumBrush}"
                BorderBrush="#3c3c3c"
                BorderThickness="1,0,0,0"
                IsVisible="{Binding IsEditMode}">
            <ScrollViewer>
                <StackPanel Margin="20">
                    <TextBlock Text="Ürün Bilgileri" FontSize="18" FontWeight="Bold" Margin="0,0,0,20"/>
                    
                    <!-- Kod -->
                    <TextBlock Text="Ürün Kodu *" Margin="0,10,0,5"/>
                    <TextBox Text="{Binding EditKod}" Watermark="Örn: KAR, DOM, ELM..."/>
                    
                    <!-- Ad -->
                    <TextBlock Text="Ürün Adı *" Margin="0,15,0,5"/>
                    <TextBox Text="{Binding EditAd}" Watermark="Ürün adını girin"/>
                    
                    <!-- Grup -->
                    <TextBlock Text="Ürün Grubu *" Margin="0,15,0,5"/>
                    <ComboBox ItemsSource="{Binding Gruplar}"
                              SelectedItem="{Binding EditGrup}"
                              PlaceholderText="Grup Seçin"
                              HorizontalAlignment="Stretch">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Ad}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <!-- Birim -->
                    <TextBlock Text="Birim" Margin="0,15,0,5"/>
                    <ComboBox ItemsSource="{Binding BirimSecenekleri}"
                              SelectedItem="{Binding EditBirim}"
                              HorizontalAlignment="Stretch"/>
                    
                    <!-- HKS Kodu -->
                    <TextBlock Text="HKS Ürün Kodu" Margin="0,15,0,5"/>
                    <TextBox Text="{Binding EditHksUrunKodu}" Watermark="Opsiyonel"/>
                    
                    <!-- Oranlar -->
                    <TextBlock Text="ORANLAR" FontSize="11" Foreground="#888" Margin="0,20,0,10" FontWeight="Bold"/>
                    
                    <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto">
                        <TextBlock Grid.Column="0" Grid.Row="0" Text="KDV %" Margin="0,0,5,5"/>
                        <TextBlock Grid.Column="1" Grid.Row="0" Text="Rusum %" Margin="5,0,5,5"/>
                        <TextBlock Grid.Column="2" Grid.Row="0" Text="Stopaj %" Margin="5,0,0,5"/>
                        
                        <NumericUpDown Grid.Column="0" Grid.Row="1" 
                                       Value="{Binding EditKdvOrani}" 
                                       Minimum="0" Maximum="50" Increment="0.5" FormatString="N1"
                                       Margin="0,0,5,0"/>
                        <NumericUpDown Grid.Column="1" Grid.Row="1" 
                                       Value="{Binding EditRusumOrani}" 
                                       Minimum="0" Maximum="50" Increment="0.5" FormatString="N1"
                                       Margin="5,0,5,0"/>
                        <NumericUpDown Grid.Column="2" Grid.Row="1" 
                                       Value="{Binding EditStopajOrani}" 
                                       Minimum="0" Maximum="50" Increment="0.5" FormatString="N1"
                                       Margin="5,0,0,0"/>
                    </Grid>
                    
                    <!-- Butonlar -->
                    <StackPanel Orientation="Horizontal" Margin="0,30,0,0" HorizontalAlignment="Right">
                        <Button Content="Iptal" Command="{Binding CancelCommand}" Margin="0,0,10,0"/>
                        <Button Content="Kaydet" Command="{Binding SaveCommand}" Classes="accent"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
        
        <!-- Sag Panel - Bos (Duzenleme degilken) -->
        <Border Grid.Column="1" 
                Background="{DynamicResource BackgroundMediumBrush}"
                BorderBrush="#3c3c3c"
                BorderThickness="1,0,0,0"
                IsVisible="{Binding !IsEditMode}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                        IsVisible="{Binding SelectedUrun, Converter={x:Static ObjectConverters.IsNull}}">
                <TextBlock Text="Ürün seçin veya" HorizontalAlignment="Center" Opacity="0.5" Margin="0,10,0,0"/>
                <TextBlock Text="yeni ürün ekleyin" HorizontalAlignment="Center" Opacity="0.5"/>
            </StackPanel>
        </Border>
        
        <!-- Loading Overlay -->
        <Border Grid.ColumnSpan="2" 
                Background="#80000000"
                IsVisible="{Binding IsLoading}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200"/>
                <TextBlock Text="Yükleniyor..." HorizontalAlignment="Center" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
