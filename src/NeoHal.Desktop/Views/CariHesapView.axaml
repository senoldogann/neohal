<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NeoHal.Desktop.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
             x:Class="NeoHal.Desktop.Views.CariHesapView"
             x:DataType="vm:CariHesapViewModel">

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{DynamicResource BackgroundMediumBrush}" Padding="10">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="+ Yeni" Command="{Binding NewCariCommand}" 
                        Background="{DynamicResource PrimaryBrush}" Foreground="White"/>
                <Button Content="Düzenle" Command="{Binding EditCariCommand}"
                        IsEnabled="{Binding SelectedCariHesap, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                <Button Content="Sil" Command="{Binding DeleteCariCommand}"
                        IsEnabled="{Binding SelectedCariHesap, Converter={x:Static ObjectConverters.IsNotNull}}"
                        Background="#F44336" Foreground="White"/>
                <Separator Width="1" Background="Gray" Margin="10,0"/>
                
                <!-- Filtreler -->
                <ComboBox PlaceholderText="Tümü" Width="150"
                          ItemsSource="{Binding CariTipleri}"
                          SelectedValue="{Binding FilterCariTipi}"
                          DisplayMemberBinding="{Binding DisplayName}"
                          SelectedValueBinding="{Binding Value}"/>
                
                <TextBox Watermark="Ara..." Width="200" Text="{Binding SearchText}"/>
                <Button Content="Ara" Command="{Binding SearchCommand}"/>
                <Button Content="Yenile" Command="{Binding LoadDataCommand}"/>
            </StackPanel>
        </Border>

        <!-- Ana İçerik -->
        <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
            
            <!-- Liste -->
            <DataGrid Grid.Column="0" 
                      ItemsSource="{Binding CariHesaplar}" 
                      SelectedItem="{Binding SelectedCariHesap}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      GridLinesVisibility="Horizontal"
                      Margin="10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Kod" Binding="{Binding Kod}" Width="100" MinWidth="60"/>
                    <DataGridTextColumn Header="Ünvan" Binding="{Binding Unvan}" Width="200" MinWidth="100"/>
                    <DataGridTextColumn Header="Tip" Binding="{Binding CariTipi}" Width="100" MinWidth="60"/>
                    <DataGridTextColumn Header="Telefon" Binding="{Binding Telefon}" Width="120" MinWidth="80"/>
                    <DataGridTextColumn Header="TC/VKN" Binding="{Binding TcKimlikNo}" Width="120" MinWidth="80"/>
                    <DataGridTextColumn Header="Bakiye" Binding="{Binding Bakiye, StringFormat={}{0:N2} TL}" Width="120" MinWidth="80"/>
                    <DataGridCheckBoxColumn Header="Aktif" Binding="{Binding Aktif}" Width="60" MinWidth="50"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Düzenleme Paneli -->
            <Border Grid.Column="1" 
                    Background="{DynamicResource BackgroundDarkBrush}" 
                    Width="350" 
                    Padding="15"
                    IsVisible="{Binding IsEditing}">
                <ScrollViewer>
                    <StackPanel Spacing="10">
                        <TextBlock Text="{Binding IsNewRecord, Converter={x:Static StringConverters.IsNullOrEmpty}, 
                                   ConverterParameter='Yeni Cari Hesap|Cari Düzenle'}" 
                                   FontSize="18" FontWeight="Bold" Foreground="White"/>
                        
                        <TextBlock Text="Cari Tipi" Foreground="Gray"/>
                        <ComboBox ItemsSource="{Binding CariTipleri}"
                                  SelectedValue="{Binding EditingCari.CariTipi}"
                                  DisplayMemberBinding="{Binding DisplayName}"
                                  SelectedValueBinding="{Binding Value}"
                                  HorizontalAlignment="Stretch"/>

                        <TextBlock Text="Kod" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Kod}" IsReadOnly="True" Background="#333"/>

                        <TextBlock Text="Ünvan *" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Unvan}" Watermark="Firma/Kişi adı"/>

                        <TextBlock Text="TC Kimlik No" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.TcKimlikNo}" Watermark="11 haneli TC" MaxLength="11"/>

                        <TextBlock Text="Vergi No" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.VergiNo}" Watermark="10 haneli VKN" MaxLength="11"/>

                        <TextBlock Text="Vergi Dairesi" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.VergiDairesi}"/>

                        <TextBlock Text="Telefon" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Telefon}" Watermark="0532 XXX XX XX"/>

                        <TextBlock Text="Telefon 2" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Telefon2}"/>

                        <TextBlock Text="E-Posta" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Email}" Watermark="ornek@mail.com"/>

                        <TextBlock Text="Adres" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.Adres}" 
                                 TextWrapping="Wrap" 
                                 AcceptsReturn="True"
                                 Height="60"/>

                        <TextBlock Text="HKS Sicil No" Foreground="Gray"/>
                        <TextBox Text="{Binding EditingCari.HksSicilNo}" Watermark="Ticaret Bakanlığı sicil no"/>

                        <CheckBox Content="Aktif" IsChecked="{Binding EditingCari.Aktif}"/>

                        <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,20,0,0">
                            <Button Content="Kaydet" Command="{Binding SaveCariCommand}" 
                                    Background="#107c10" Foreground="White" Width="100"/>
                            <Button Content="İptal" Command="{Binding CancelEditCommand}" Width="100"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{DynamicResource PrimaryBrush}" Padding="10,5">
            <TextBlock Text="{Binding StatusMessage}" Foreground="White"/>
        </Border>
    </Grid>
</UserControl>
